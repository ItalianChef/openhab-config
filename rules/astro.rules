
import org.joda.time.*

rule "elevation"
when
	Item SunElevation changed
then
	if(SunElevation.state >  0){
		if(NightState.state != ON){
			logInfo("RULE", "Sun is crossing the horizon, switching to daylight mode")
			NightState.sendCommand(ON)
			SunriseEvent.sendCommand(ON)
			createTimer(now.plusSeconds(3)) [|
				SunriseEvent.sendCommand(OFF)
			]
		}
	} else {
		if(NightState.state != OFF) {
			logInfo("RULE", "Sun is crossing the horizon, switching to night mode")
			NightState.sendCommand(OFF)
			SunsetEvent.sendCommand(ON)
			createTimer(now.plusSeconds(3)) [|
				SunsetEvent.sendCommand(OFF)
			]
		}
	}
end

rule "OpenHAB system started - astro"
when
	System started
then {
	createTimer(now.plusSeconds(180)) [|
		logInfo("RULE", "--> astro init")
		if (now.isAfter((SunsetTime.state as DateTimeType).calendar.timeInMillis) ||
			now.isBefore((SunriseTime.state as DateTimeType).calendar.timeInMillis)
		) {
			logInfo("RULE", "--> Night_State ON")
			postUpdate(NightState, ON)
		} else {
			logInfo("RULE", "--> Night_State OFF")
			postUpdate(NightState, OFF)
		}
	]
}
end


rule "Night_State update"
when
	Item Sunset_Event changed to OFF or
	Item Sunrise_Event changed to ON
then
	logInfo("RULE", "--> Night_State set to " + previousState)
	postUpdate(NightState, previousState)
end




















