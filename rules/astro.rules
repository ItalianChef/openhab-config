import org.joda.time.*

rule "OpenHAB system started - astro"
when
	System started
then {
	// delayed startup because the rules engine starts to early...
	createTimer(now.plusSeconds(8)) [|
		logInfo("RULE", "--> astro init")
		AstroRules.
		if (now.isAfter((SunsetTime.state as DateTimeType).calendar.timeInMillis) ||
			now.isBefore((SunriseTime.state as DateTimeType).calendar.timeInMillis)
		) {
			logInfo("RULE", "--> Night_State ON")
			postUpdate(NightState, ON)
		} else {
			logInfo("RULE", "--> Night_State OFF")
			postUpdate(NightState, OFF)
		}
	]
}
end


rule "Night_State update"
when
	Item Sunset_Event changed to OFF or
	Item Sunrise_Event changed to ON
then
	logInfo("RULE", "--> Night_State set to " + previousState)
	postUpdate(NightState, previousState)
end




















